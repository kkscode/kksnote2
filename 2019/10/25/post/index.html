<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>腾讯云与GCP跨云服商VPC对联实践 | Hexo</title>
  <meta name="keywords" content=" GCP , tencent , vpc ">
  <meta name="description" content="腾讯云与GCP跨云服商VPC对联实践 | Hexo">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick">
<meta property="og:type" content="article">
<meta property="og:title" content="Hello World">
<meta property="og:url" content="https:&#x2F;&#x2F;kkscode.github.io&#x2F;kksnote2&#x2F;2019&#x2F;10&#x2F;25&#x2F;hello-world&#x2F;index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-10-25T08:42:13.124Z">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/kksnote2/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/kksnote2/css/hl_theme/atom-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/kksnote2/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/kksnote2/js/iconfont.js?v=1.0.1" ></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="/kksnote2">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/kksnote2/" class="avatar_target">
    <img class="avatar" src="/kksnote2/img/avatar.jpg" />
</a>
<div class="author">
    <span>kks</span>
</div>

<div class="icon">
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(3)</small></div></li>
    
        
            
            <li><div data-rel="探索笔记">探索笔记<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="读书"><i class="fold iconfont icon-right"></i>读书<small>(1)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="阅读笔记">阅读笔记<small>(1)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="3">
<input type="hidden" id="yelog_site_word_count" value="1.3k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="Search..." autocomplete="off"id="local-search-input" >
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">GCP</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">tencent</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">vpc</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">reading</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class="探索笔记 "
           href="/kksnote2/2019/10/25/post/"
           data-tag="GCP,tencent,vpc"
           data-author="" >
            <span class="post-title" title="腾讯云与GCP跨云服商VPC对联实践">腾讯云与GCP跨云服商VPC对联实践</span>
            <span class="post-date" title="2019-10-25 11:24:33">2019/10/25</span>
        </a>
        
        <a  class="读书 阅读笔记 "
           href="/kksnote2/2019/06/09/misfortune-intellectual/"
           data-tag="reading"
           data-author="" >
            <span class="post-title" title="[记]《知识分子的不幸》-王小波">[记]《知识分子的不幸》-王小波</span>
            <span class="post-date" title="2019-06-09 21:31:09">2019/06/09</span>
        </a>
        
        <a  class=""
           href="/kksnote2/2019/10/25/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2019-10-25 16:42:13">2019/10/25</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-post" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">腾讯云与GCP跨云服商VPC对联实践</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a href="javascript:" data-rel="探索笔记">探索笔记</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color4">GCP</a>
            
            <a href="javascript:" class="color3">tencent</a>
            
            <a href="javascript:" class="color4">vpc</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2019-10-25 16:46:05'>2019-10-25 11:24</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:549</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#连通目标"><span class="toc-text">连通目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#需要用到的服务"><span class="toc-text">需要用到的服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#先决条件"><span class="toc-text">先决条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#整体流程"><span class="toc-text">整体流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#腾讯云-创建VPN网关"><span class="toc-text">腾讯云-创建VPN网关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GCP-创建VPN-gateway"><span class="toc-text">GCP-创建VPN gateway</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#腾讯云-创建对端网关"><span class="toc-text">腾讯云-创建对端网关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#腾讯云-创建VPN通道"><span class="toc-text">腾讯云-创建VPN通道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GCP-建立-VPN-Connections"><span class="toc-text">GCP: 建立 VPN Connections</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#腾讯云-更新路由表"><span class="toc-text">腾讯云-更新路由表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试连通"><span class="toc-text">测试连通</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="连通目标"><a href="#连通目标" class="headerlink" title="连通目标"></a>连通目标</h2><p>受<a href="https://medium.com/@oleg.pershin/site-to-site-vpn-between-gcp-and-aws-with-dynamic-bgp-routing-7d7e0366036d" target="_blank" rel="noopener">aws和gcp vpc互通</a>的启发，尝试使用类似的方式使GCP和腾讯云互通。本文测试环境为香港腾讯云和香港GCP.</p>
<h2 id="需要用到的服务"><a href="#需要用到的服务" class="headerlink" title="需要用到的服务"></a>需要用到的服务</h2><ul>
<li>GCP<ol>
<li>Hybrid Connectivity - VPN</li>
<li>Compute Engine(用于测试连通性)</li>
</ol>
</li>
<li>腾讯云<ol>
<li>VPN网关</li>
<li>VPN通道</li>
<li>对端网关</li>
<li>cvm(用于测试连通性)</li>
</ol>
</li>
</ul>
<h2 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h2><p>腾讯云和GCP创建好用于连通的vpc</p>
<h2 id="整体流程"><a href="#整体流程" class="headerlink" title="整体流程"></a>整体流程</h2><ol>
<li>腾讯云: 创建VPN网关</li>
<li>GCP: 创建VPN gateway 并获取一个public static ip</li>
<li>腾讯云: 创建对端网关</li>
<li>腾讯云: 创建VPN通道</li>
<li>GCP: 建立 VPN Connections</li>
<li>腾讯云: 更新路由表</li>
<li>测试连通</li>
</ol>
<h2 id="腾讯云-创建VPN网关"><a href="#腾讯云-创建VPN网关" class="headerlink" title="腾讯云-创建VPN网关"></a>腾讯云-创建VPN网关</h2><p><img src="/kksnote2/images/tencent-vgw.png" alt="腾讯云VPN网关"><br><strong><em>所属网络为要对联的VPC</em></strong></p>
<h2 id="GCP-创建VPN-gateway"><a href="#GCP-创建VPN-gateway" class="headerlink" title="GCP-创建VPN gateway"></a>GCP-创建VPN gateway</h2><p>Hybrid Connectivity -&gt; VPN -&gt; Cloud VPN Gateways -&gt; Create VPN gateway. 由于似乎腾讯云不支持BGP，这里的VPN options我们选<strong>Classic VPN</strong>. </p>
<ol>
<li>Reserve static ip<br><img src="/kksnote2/images/gcp-reserve-ip.png" alt="Reserve static ip"><br>这个ip记录下来，后面要用到。</li>
<li>腾讯云通道还没设置，下面的tunnels先删掉.<br><img src="/kksnote2/images/gcp-tunnels.png" alt="delete tunnels"></li>
</ol>
<h2 id="腾讯云-创建对端网关"><a href="#腾讯云-创建对端网关" class="headerlink" title="腾讯云-创建对端网关"></a>腾讯云-创建对端网关</h2><p><img src="/kksnote2/images/tencent-op-vgw.png" alt="对端网关"><br>ip 为上一步<strong>GCP的网关ip</strong></p>
<h2 id="腾讯云-创建VPN通道"><a href="#腾讯云-创建VPN通道" class="headerlink" title="腾讯云-创建VPN通道"></a>腾讯云-创建VPN通道</h2><p><img src="/kksnote2/images/tencent-vpn-tunnel1.png" alt="第一步"><br><img src="/kksnote2/images/tencent-vpn-tunnel2.png" alt="第二步"><br>本地网段: <strong>腾讯云VPC的CIDR</strong><br>对端网段: <strong>GCP VPC的CIDR</strong></p>
<p><a href="https://cloud.tencent.com/document/product/554/18989" target="_blank" rel="noopener">腾讯官方文档</a>.需要注意的是腾讯云只支持ikeV1,<a href="https://cloud.tencent.com/document/product/554/18904" target="_blank" rel="noopener">腾讯</a>和<a href="https://cloud.google.com/vpn/docs/concepts/supported-ike-ciphers#phase-1_3" target="_blank" rel="noopener">GCP</a>支持列表。综合起来设置为:</p>
<ul>
<li>密钥: 自己生成记录下来，在GCP端需要用到.</li>
<li>加密算法: AES-128</li>
<li>认证算法: SHA1</li>
<li>DH group: DH2</li>
<li>安全协议: ESP</li>
<li>PFS: DH-GROUP2<br><img src="/kksnote2/images/tencent-ike.png" alt="腾讯云ike"><br><img src="/kksnote2/images/tencent-ipsec.png" alt="腾讯云ipsec"></li>
</ul>
<h2 id="GCP-建立-VPN-Connections"><a href="#GCP-建立-VPN-Connections" class="headerlink" title="GCP: 建立 VPN Connections"></a>GCP: 建立 VPN Connections</h2><p>Hybrid Connectivity -&gt; VPN -&gt; Cloud VPN Gateways -&gt; 对应gateway -&gt; Add VPN tunnel</p>
<ul>
<li>Remote peer IP address : 腾讯云VPN网关ip</li>
<li>IKE pre-shared key: 上一步中自己生成的密钥</li>
<li>Routing options : Policy-based</li>
<li>Remote network IP range: 腾讯云VPN CIDR</li>
<li>Local subnetwork IP range: GCP要连通的CIDR</li>
</ul>
<p>这一步结束两端状态应该如下:<br>    <img src="/kksnote2/images/gcp-tunnel-status.png" alt="GCP状态"><br>    <img src="/kksnote2/images/tencent-tunnel-status.png" alt="腾讯云状态"></p>
<h2 id="腾讯云-更新路由表"><a href="#腾讯云-更新路由表" class="headerlink" title="腾讯云-更新路由表"></a>腾讯云-更新路由表</h2><p>私有网络 -&gt; 路由表 -&gt; 找到对应VPC路由表 -&gt; 新增路由策略</p>
<ul>
<li>目的端: GCP VPC CIDR</li>
<li>下一跳类型: VPN网关</li>
<li>下一跳: VPN网关</li>
</ul>
<h2 id="测试连通"><a href="#测试连通" class="headerlink" title="测试连通"></a>测试连通</h2><p>简单的测试方式可以登录其中一台机器,ssh username@ip的方式,ip为另一个VPC的测试机的vpc内ip,如果提示<code>Permission denied (publickey,gssapi-keyex,gssapi-with-mic)</code>说明网络已通.</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 jaytp@qq.com </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>腾讯云与GCP跨云服商VPC对联实践</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">549</span></p>
    <p><span class="copy-title">本文作者:</span><a href="javascript:void(0)" title="kks">kks</a></p>
    <p><span class="copy-title">发布时间:</span>2019-10-25, 11:24:33</p>
    <p><span class="copy-title">最后更新:</span>2019-10-25, 16:46:05</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/kksnote2/2019/10/25/post/" title="腾讯云与GCP跨云服商VPC对联实践">https://kkscode.github.io/kksnote2/2019/10/25/post/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>



    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/kksnote2/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '040cccd7aa241407e765',
            clientSecret: 'c0096119abb459a33c3cf57b12e742091fb12add',
            repo: 'kkscode.github.io/kksnote2/',
            owner: 'kkscode',
            admin: ['kkscode'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2016-2019 Yelog</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

</body>
<script src="/kksnote2/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/kksnote2/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#GCP','#tencent','#vpc','#reading',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("/kksnote2https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
